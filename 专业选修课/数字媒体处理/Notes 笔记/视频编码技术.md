## 视频压缩的框架结构

- 颜色空间变换
  - 图像子采样：分量在数字化过程中采样的频率可以不同，降低数据量
- 分块
  - 降低变换的复杂度
- 运动补偿
  - 在时间轴上去除冗余度
- 变换编码与量化
- 熵编码、自适应算术编码
- 基于对象的编码方式



## 视频数据压缩原理

- 空间冗余性
  - 变换编码
  - 帧内预测编码
- 时间冗余性
  - 帧间预测
  - 运动补偿

### 图像分块

- 进行DCT变换
- 视频中：宏块（只有动态视频的压缩过程中才有宏块的概念，宏块用于运动的估计和运动的补偿）

### 变化与量化

### 变换后处理

- Hadamard 变换，

### 帧间预测

- 运动估计：找到一个最接近的参考块
- 运动补偿：得到残差块，运动向量

### GOP 中的三类图像

- 帧内图像 I **基准，数据量最大**
  - I 帧 是按照图像压缩的标准进行压缩的帧，不考虑前后图像的关联性，原封不动按照静态图像的方法进行编码
  - 一秒钟内有两个 I 帧
  - **如果没有 I 帧（只有开头一个 I 帧），快进时每一帧都需要从头进行解码**
- 单向预测 P
  - P 帧是根据 I 帧进行预测（参考帧）
  - P 帧的数据量比 I 帧小的多， P 帧和 I 帧的相关性比较强
- 双向预测 B
  - 根据 I 帧和 P 帧进行预测
  - 数据量更小

#### I 帧图像编码算法

按照静态图像的方式进行编码

1. 颜色空间的变换

   - 数字视频采样的结果在 RGB 三色空间中，需要把 RGB 颜色空间转换为 YCbCr 颜色空间 （亮度，色度空间）。

   - **为什么**

     > 我们现在处理的都是彩色图像，彩色有三个分量，对于图像处理，更重要的时亮度，色度，饱和度

     - **图像子采样**：最重要的是亮度空间，可以按照 4:2:0 的采样方式，直接降低数据量

2. 图像分块+DCT 变换 + 量化 Q

   > 颜色空间有三部分，每个部分都需要处理

   - 每个图像平面分成 8x8 图块

   - DCT 变换：

     > 为什么用 DCT？

     - 不需要计算 DCT 变换的矩阵，分块后大部分分块都很类似
     - KR 变换的效果更好，但是没有必要

   - 量化

     - DCT 变换之后，左上角都是低频分量，需要的量化间距较小，而靠右下角大部分都是高频分量，量化的间距可以较大

   - Zig-zig Z字形编码

   - DPCM

     - 预测：每个分块之间进行预测，因此可以在相邻分块之间进行差分，只编码预测值和实际值之间的差值

     - 处理直流分量

   - RLE 

     - 行程编码

3. 熵编码

   使用统计的方法，根据符号出现的概率，对符号进行编码

   - 霍夫曼编码
   - 算术编码

#### P 帧图像的编码

P 帧参考 I 帧，因此涉及到运动估计和运动补偿

1. 运动估计 **运动矢量算法**

   找到最相近的参考块

   每一个宏块划定一个参考的范围（搜索窗口），在窗口中搜索最佳匹配的宏块

2. 运动补偿

   与最近的参考块求差值

3. 对于 Y Cr Cb 每个分量都进行 DCT + 量化 + RLE

4. 霍夫曼编码

#### D 帧的编码

在过去的参考图像和将来的参考图像中都分别找最佳的参考宏块，

将这两个宏块求平均，然后在用待编码的宏块和平均宏块进行补偿。



H.265 H.266 和 H.264 之间的区别

