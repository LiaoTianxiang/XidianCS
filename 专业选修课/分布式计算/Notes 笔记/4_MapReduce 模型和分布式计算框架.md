# MR 模型和分布式计算框架

## MR 并行计算模型

适用于输入数据量大的计算，不适于输入数据少，但运算量大的数据

三个阶段：

- Map 阶段

  首先数据分片，分片后的数据交给一个 map 子任务来处理，不同的 Map 任务放到一个计算节点中进行，Map 任务运算完之后得到一个中间结果，

  **强制要求，Map 计算的结果输出为 （key, value） 键值对的形式**

- 聚集混洗阶段（二次分片）

  交换数据和数据聚集，同一个 Map 节点中，可能会输出多个不同的key 值的键值对，需要重新排序，然后再聚集，把相同key的键值对聚集在一起

  （k1 ,(v1, v4)）(k3, (v3, v6)) 形成这样的形式

  现在 value 变得复杂，变成 list 的形式，（key, values），聚集之后再按照 key 进行分片

- Reduce 阶段

  经过聚集混洗后的中间结果可能还会很大，将 key 进行排序，然后经过 并行的reduce，分片，生成 (KEY, val) 形式的键值对

**通过key值部分控制不同子任务输出结果的相互交换和聚集**

要点

1. 抽象出 map
2. 靠什么来控制中间结果的聚集 （靠 key 值）
3. 想不起来了

![](http://media.sumblog.cn/img/20190527143551.png-min_pic)

**MapReduce的好处**

- 抽象出平台和应用模块
  - 平台，和具体的计算任务无关 （平台的任务很机械，比如按照 key 进行排序聚集和分片）
  - 应用模块：和计算任务有关 （负责定制Map、Reduce逻辑）



**如何用 Map Reduce 模型实现以下功能：**

1. 数据过滤：

   Map 阶段将不需要的数据去除

2. 统计不同网页被引用的频率

   Map 子任务输入不同的网页，map 阶段打开网页，搜索 a 标签，输出 <url，1> 形式的标签

   reduce 阶段会把相同url的键值对聚集，统计

3. 生成网页数据库的全文检索索引 (倒排索引)

   Map 阶段：<word, url> 用单词作为key

   Recuce 阶段：<word, url列表> 把相同的  url 进行计数

## Hadoop MR 分布式平台

![](http://media.sumblog.cn/img/20190527154228.png-min_pic)

## MapReduce 程序构成

![](http://media.sumblog.cn/img/20190527154624.png-min_pic)

